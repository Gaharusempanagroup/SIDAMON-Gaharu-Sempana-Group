function renderSKK(data) {
      const tbody = document.getElementById('bodySkk'); 
      tbody.innerHTML = '';
      
      let expired = 0, usedSet = new Set();
      
      // 1. Hitung Statistik (Data Mentah)
      data.forEach(row => {
          const status = (row[10]||"").toLowerCase(); 
          const ket = (row[11]||"").toLowerCase(); 
          const nama = (row[1]||"").trim();
          
          if (status.includes('expired') || ket.includes('expired')) expired++;
          else if (status.includes('used') || ket.includes('used')) { if(nama) usedSet.add(nama); }
      });
      
      animateValue("skk-total", 0, data.length, 800); 
      animateValue("skk-expired", 0, expired, 800); 
      animateValue("skk-used", 0, usedSet.size, 800);

      if(data.length === 0) {
          document.getElementById('msgSkk').classList.remove('d-none');
          return;
      } else {
          document.getElementById('msgSkk').classList.add('d-none');
      }

      // 2. GROUPING DATA
      const groupedData = {};
      
      data.forEach((row, originalIndex) => {
          const nama = row[1];
          if (!nama) return;

          if (!groupedData[nama]) {
              groupedData[nama] = {
                  nama: row[1],
                  hp: row[2],
                  perusahaan: row[4], 
                  bidang: row[3],
                  items: [] 
              };
          }

          // Simpan data raw status ke dalam item untuk dicek nanti
          groupedData[nama].items.push({
              sertifikat: row[5],
              jenjang: row[6],
              sisaWaktu: row[9],
              statusRaw: row[10], // Penting: Simpan status mentah per item
              ketRaw: row[11],    // Penting: Simpan keterangan mentah per item
              originalIndex: originalIndex
          });
      });

      // 3. RENDER DATA GROUPED DENGAN LOGIKA PRIORITAS
      Object.values(groupedData).forEach(person => {
          
          // --- A. LOGIKA PENENTUAN STATUS GLOBAL PERSONIL ---
          let isUsed = false;
          let hasActive = false;
          let activeCount = 0;
          let totalCert = person.items.length;
          let usedProjectName = ""; // Untuk menyimpan nama proyek jika status used

          person.items.forEach(item => {
              let s = (item.statusRaw || "").toLowerCase();
              let k = (item.ketRaw || "").toLowerCase();
              
              if (s.includes('used') || k.includes('used')) {
                  isUsed = true;
                  usedProjectName = item.statusRaw.includes('used') ? item.statusRaw : item.ketRaw;
              }
              if (s.includes('active') || s.includes('available')) {
                  hasActive = true;
                  activeCount++;
              }
          });

          // Tentukan Badge Status Akhir berdasarkan Prioritas
          let finalBadge = "";
          
          if (isUsed) {
              // Prioritas 1: Jika ada yg terpakai, status orangnya "Used"
              finalBadge = `<span class="badge-status status-used" title="${usedProjectName}">Used</span>`; 
          } else if (hasActive) {
              // Prioritas 2: Jika tidak ada yg terpakai, tapi ada yg aktif, status "Available"
              // Kita bisa tambahkan info jumlah (opsional), misal: Available (2/3)
              // Tapi agar rapi sesuai request, kita pakai "Available" saja atau "Active"
              finalBadge = `<span class="badge-status status-active">Available</span>`;
          } else {
              // Prioritas 3: Jika tidak ada yg used dan tidak ada yg active (semua expired)
              finalBadge = `<span class="badge-status status-expired">Expired</span>`;
          }


          // --- B. RENDER KOLOM LAINNYA ---
          let btnWA = "-";
          if(person.hp && person.hp.match(/\d+/)) {
              let cleanNum = person.hp.toString().replace(/\D/g, ''); 
              if(cleanNum.startsWith('0')) cleanNum = '62' + cleanNum.substring(1);
              if(cleanNum.length > 9) { 
                  btnWA = `<a href="https://wa.me/${cleanNum}" target="_blank" class="btn btn-success btn-sm text-white fw-bold d-inline-flex align-items-center justify-content-center" style="font-size: 0.7rem; padding: 2px 8px; height: 24px; min-width: 60px;"><i class="bi bi-whatsapp" style="font-size: 0.8rem; margin-right: 4px;"></i> Chat</a>`; 
              } else { 
                  btnWA = `<span class="small text-muted">${person.hp}</span>`; 
              }
          }

          let htmlSertifikat = '', htmlJenjang = '', htmlSisa = '', htmlKet = '', htmlAksi = '';

          person.items.forEach(item => {
              // Warna teks sisa waktu: Merah jika expired/kurang dari 0
              let sisaStyle = "";
              if ((item.statusRaw||"").toLowerCase().includes('expired')) {
                  sisaStyle = "color: #dc3545; font-weight:bold;"; // Merah
              }

              htmlSertifikat += `<div class="nested-cell fw-bold" title="${item.sertifikat}">${item.sertifikat}</div>`;
              htmlJenjang += `<div class="nested-cell text-center justify-content-center">${item.jenjang || '-'}</div>`;
              htmlSisa += `<div class="nested-cell text-center justify-content-center small" style="${sisaStyle}">${item.sisaWaktu || '-'}</div>`;
              htmlKet += `<div class="nested-cell small text-muted" title="${item.ketRaw || ''}">${item.ketRaw || '-'}</div>`;
              
              if (currentUserRole === "SUPER_ADMIN" || currentUserRole === "ADMIN_INPUT") {
                  htmlAksi += `<div class="nested-cell nested-cell-action">
                      <button class="btn btn-sm btn-outline-primary rounded-circle" onclick="openModalEdit(${item.originalIndex})" style="width: 24px; height: 24px; padding: 0;" title="Edit Sertifikat Ini">
                          <i class="bi bi-pencil-fill" style="font-size: 0.7rem;"></i>
                      </button>
                  </div>`;
              }
          });

          const styleAksi = (currentUserRole === "SUPER_ADMIN" || currentUserRole === "ADMIN_INPUT") ? '' : 'display:none;';

          tbody.innerHTML += `
            <tr>
              <td class="align-middle-person">
                  <div class="fw-bold text-dark">${person.nama}</div>
                  <div class="small text-muted"><i class="bi bi-building me-1"></i>${person.perusahaan || '-'}</div>
              </td>
              <td class="text-center align-middle-person">${btnWA}</td>
              <td class="align-middle-person small">${person.bidang || '-'}</td>
              
              <td style="padding-top:0; padding-bottom:0;">${htmlSertifikat}</td>
              <td style="padding-top:0; padding-bottom:0;">${htmlJenjang}</td>
              <td style="padding-top:0; padding-bottom:0;">${htmlSisa}</td>
              
              <td class="text-center align-middle-person">${finalBadge}</td>

              <td style="padding-top:0; padding-bottom:0;">${htmlKet}</td>
              <td class="text-center" style="padding-top:0; padding-bottom:0; ${styleAksi}">${htmlAksi}</td>
            </tr>
          `;
      });
    }
